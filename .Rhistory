j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_type.pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")
if (facet="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+
theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")
if (facet="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")
if (facet="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_type.pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=variable,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=variable,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_facet(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=variable,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=variable,y=varlable,label=round(r,2)),size=3,col="#ffffff")+ coord_flip()+
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_face(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")+ coord_flip()+
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_face(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")+ coord_flip()
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")+ coord_flip()
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_face(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=varlable,y=variable,fill=r))+geom_tile()+facet_grid(cols = vars(cancertype))+
geom_text(aes(x=varlable,y=variable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_face(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
Cor_heatmap <- function(file,var_index,output="NA",n_sig,minsample,width = 12,height = 30,facet) {
library(grid)
rm(g1,p1,p_type,p_all,p_ave)
p_type <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,minsample=minsample)
p_all <- heatmap_plot_multi_variable(file,varcol=var_index,n_sig=n_sig,Type=F)
p_ave <- p_type %>%
group_by(variable,varlable) %>%
dplyr::summarize(value=mean(r))
coul = colorRampPalette(brewer.pal(8, "RdBu"))(256)
par(bg = 'white')
if (facet=="cancertype") p1 <- ggplot(p_type,aes(x=variable,y=varlable,fill=r))+geom_tile()+facet_grid(cols = vars(cancertype))+
geom_text(aes(x=variable,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="signature") p1 <- ggplot(p_type,aes(x=cancertype,y=varlable,fill=r))+geom_tile()+facet_grid(rows = vars(variable))+
geom_text(aes(x=cancertype,y=varlable,label=round(r,2)),size=3,col="#ffffff")
if (facet=="measure") p1 <- ggplot(p_type,aes(x=cancertype,y=variable,fill=r))+geom_tile()+facet_grid(rows = vars(varlable))+
geom_text(aes(x=cancertype,y=variable,label=round(r,2)),size=3,col="#ffffff")
p1 <- p1 + scale_fill_gradient2(low=coul[1],mid="#ffffff",high=coul[256],midpoint = 0,name="Spearman Correlation")+
#labs(subtitle = paste0(varlabel))+
#annotate('text',x=1:nrow(cor_n_type),y=rep(n_sig+0.7,each=nrow(cor_n_type)),label=cor_n_type[,2],size=3)+
ylab("")+xlab("")+ theme(axis.text.x = element_text(angle = 45, hjust = 1,size=10),
axis.text.y=element_text(size=10),
legend.position = "right",legend.text = element_text(size=6),
legend.title = element_text(size=10,face="bold"),
axis.title.y = element_text(size=12,face="bold"),
plot.margin = unit(c(3,1,1,1),"lines"),panel.background = element_rect(fill = "white",colour = "grey",size = 0.5, linetype = "solid"),
panel.grid.minor.y = element_blank(),
strip.text.y = element_text(color="white",size=12))
#coord_cartesian(ylim=c(1,n_sig+0.4))
g1 <- ggplotGrob(p1)
my_color <- brewer.pal(8, "Set3")[c(1,3:8,2)]
### change the color of facet strips
strip_both <- which(grepl('strip-', g1$layout$name))
k <- 1
for (i in strip_both) {
j1 <- which(grepl('rect', g1$grobs[[i]]$grobs[[1]]$childrenOrder))
g1$grobs[[i]]$grobs[[1]]$children[[j1]]$gp$fill <- my_color[k]
k <- k+1
}
pdf(file=output,width = width,height = height)
grid.draw(g1)
dev.off()
}
Cor_heatmap(EvoExposure_merge_snv_immune,output="immune_correlation_face(type).pdf",var_index = 40:99,n_sig=5,minsample=10,height=15,width=50,facet="cancertype")
files.sources = list.files("D:/Project/Xinyu/EvoDynamicsSignature/R")
sapply(files.sources,source)
setwd(D:\Project\Xinyu\EvoDynamicsSignature\")
setwd("D:\Project\Xinyu\EvoDynamicsSignature\")
setwd("Data\Project\Xinyu\EvoDynamicsSignature\")
setwd("D:\Project\Xinyu\EvoDynamicsSignature\")
cwd
setwd("D:\Project\Xinyu\EvoDynamicsSignature\")
cwd
pwd
setwd("D:/Project/Xinyu/EvoDynamicsSignature")
library(roxygen2)
roxygenize("R/Association_heatmap")
library(roxygen2)
install.packages("roxygen2")
library(roxygen2)
roxygenize("R/Association_heatmap")
library(EvoDynamicsSignature)
roxygenize("R/Association_heatmap")
setwd("D:/Project/Xinyu/")
roxygenize("Association_heatmap")
setwd("D:/Project/Xinyu/")
library(roxygen2)
roxygenize("Association_heatmap")
roxygenize("EvoDynamicsSignature")
roxygenize("EvoDynamicsSignature")
library(roxygen2)
roxygenize("EvoDynamicsSignature")
setwd("D:/Project/Xinyu/EvoDynamicsSignatures")
setwd("D:/Project/Xinyu/EvoDynamicsSignatures/")
setwd("D:/Project/Xinyu/EvoDynamicsSignature/")
library(EvoDynamiscSignatures)
library(EvoDynamicsSignatures)
